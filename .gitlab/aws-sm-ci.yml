prepare-secret:
  before_script:
    - oc login --token=$GITLAB_SA_TOKEN --insecure-skip-tls-verify=true $MASTER_PUBLIC_URL
    - oc project "$PROJECT"
  script:
    - unset AWS_SECRET_ACCESS_KEY
    - unset AWS_ACCESS_KEY_ID
    - ENVPAY_GLO_COMMON=`aws secretsmanager get-secret-value --version-stage AWSCURRENT --secret-id NON-PROD/$ENV/$PROJECT/ENVPAY_GLO_COMMON --output text --query SecretString ` || ENVPAY_GLO_COMMON=`aws secretsmanager get-secret-value --version-stage AWSCURRENT --secret-id NON-PROD/DEV/ENVPAY_GLO_COMMON --output text --query SecretString `
    - ENVPAY_GLO_COMMON_MERCHANT_ID=`echo $ENVPAY_GLO_COMMON | jq '.MERCHANT_ID' -r`
    - ENVPAY_GLO_COMMON_SECRET=`echo $ENVPAY_GLO_COMMON | jq '.SECRET' -r`
    - ENVPAY_GLO_COMMON_ACCOUNT=`echo $ENVPAY_GLO_COMMON | jq '.ACCOUNT' -r`
    - oc delete secret envpay-glo-common || true
    - oc create secret generic envpay-glo-common --from-literal=merchant_id=${ENVPAY_GLO_COMMON_MERCHANT_ID} --from-literal=secret=${ENVPAY_GLO_COMMON_SECRET} --from-literal=account=${ENVPAY_GLO_COMMON_ACCOUNT}

    - ENVPAY_CMI=`aws secretsmanager get-secret-value --version-stage AWSCURRENT --secret-id NON-PROD/$ENV/$PROJECT/ENVPAY_CMI --output text --query SecretString ` || ENVPAY_CMI=`aws secretsmanager get-secret-value --version-stage AWSCURRENT --secret-id NON-PROD/DEV/ENVPAY_CMI --output text --query SecretString `
    - ENVPAY_CMI_MERCHANT_ID=`echo $ENVPAY_CMI | jq '.MERCHANT_ID' -r`
    - ENVPAY_CMI_STOREKEY=`echo $ENVPAY_CMI | jq '.STOREKEY' -r`
    - oc delete secret envpay-cmi || true
    - oc create secret generic envpay-cmi --from-literal=merchant_id=${ENVPAY_CMI_MERCHANT_ID} --from-literal=storekey=${ENVPAY_CMI_STOREKEY}

    - ENVPAY_PAYGATE=`aws secretsmanager get-secret-value --version-stage AWSCURRENT --secret-id NON-PROD/$ENV/$PROJECT/ENVPAY_PAYGATE --output text --query SecretString ` || ENVPAY_PAYGATE=`aws secretsmanager get-secret-value --version-stage AWSCURRENT --secret-id NON-PROD/DEV/ENVPAY_PAYGATE --output text --query SecretString `
    - ENVPAY_PAYGATE_KEY=`echo $ENVPAY_PAYGATE | jq '.KEY' -r`
    - ENVPAY_PAYGATE_ID=`echo $ENVPAY_PAYGATE | jq '.ID' -r`
    - ENVPAY_PAYGATE_EMAIL=`echo $ENVPAY_PAYGATE | jq '.EMAIL' -r`
    - oc delete secret envpay-paygate || true
    - oc create secret generic envpay-paygate --from-literal=key=${ENVPAY_PAYGATE_KEY} --from-literal=id=${ENVPAY_PAYGATE_ID} --from-literal=email=${ENVPAY_PAYGATE_EMAIL}

    - ENVPAY_TINGG=`aws secretsmanager get-secret-value --version-stage AWSCURRENT --secret-id NON-PROD/$ENV/$PROJECT/ENVPAY_TINGG --output text --query SecretString ` || ENVPAY_TINGG=`aws secretsmanager get-secret-value --version-stage AWSCURRENT --secret-id NON-PROD/DEV/ENVPAY_TINGG --output text --query SecretString `
    - ENVPAY_TINGG_ACCESS_KEY=`echo $ENVPAY_TINGG | jq '.```   ' -r`
    - ENVPAY_TINGG_ACCOUNT_NUMBER=`echo $ENVPAY_TINGG | jq '.ACCOUNT_NUMBER' -r`
    - ENVPAY_TINGG_IVKEY=`echo $ENVPAY_TINGG | jq '.IVKEY' -r`
    - ENVPAY_TINGG_SECRET_KEY=`echo $ENVPAY_TINGG | jq '.SECRET_KEY' -r`
    - ENVPAY_TINGG_SERVICE_CODE=`echo $ENVPAY_TINGG | jq '.SERVICE_CODE' -r`
    - oc delete secret envpay-tingg || true
    - oc create secret generic envpay-tingg --from-literal=access_key=${ENVPAY_TINGG_ACCESS_KEY} --from-literal=account_number=${ENVPAY_TINGG_ACCOUNT_NUMBER} --from-literal=ivkey=${ENVPAY_TINGG_IVKEY} --from-literal=secret_key=${ENVPAY_TINGG_SECRET_KEY} --from-literal=service_code=${ENVPAY_TINGG_SERVICE_CODE}

    - ENVPAY_FAW=`aws secretsmanager get-secret-value --version-stage AWSCURRENT --secret-id NON-PROD/$ENV/$PROJECT/ENVPAY_FAW --output text --query SecretString ` || ENVPAY_FAW=`aws secretsmanager get-secret-value --version-stage AWSCURRENT --secret-id NON-PROD/DEV/ENVPAY_FAW --output text --query SecretString `
    - ENVPAY_FAW_MERCHANT_ID=`echo $ENVPAY_FAW | jq '.MERCHANT_ID' -r`
    - ENVPAY_FAW_SECRET_KEY=`echo $ENVPAY_FAW | jq '.SECRET_KEY' -r`
    - oc delete secret envpay-faw || true
    - oc create secret generic envpay-faw --from-literal=merchant_id=${ENVPAY_FAW_MERCHANT_ID} --from-literal=secret_key=${ENVPAY_FAW_SECRET_KEY}

    - ENVPAY_PAYPAL=`aws secretsmanager get-secret-value --version-stage AWSCURRENT --secret-id NON-PROD/$ENV/$PROJECT/ENVPAY_PAYPAL --output text --query SecretString ` || ENVPAY_PAYPAL=`aws secretsmanager get-secret-value --version-stage AWSCURRENT --secret-id NON-PROD/DEV/ENVPAY_PAYPAL --output text --query SecretString `
    - ENVPAY_PAYPAL_ACCOUNT=`echo $ENVPAY_PAYPAL | jq '.ACCOUNT' -r`
    - oc delete secret envpay-paypal || true
    - oc create secret generic envpay-paypal --from-literal=account=${ENVPAY_PAYPAL_ACCOUNT}


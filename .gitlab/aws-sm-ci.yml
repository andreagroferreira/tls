prepare-secret:
  before_script:
    - oc login --token=$GITLAB_SA_TOKEN --insecure-skip-tls-verify=true $MASTER_PUBLIC_URL
    - oc project "$PROJECT"
  script:
    - unset AWS_SECRET_ACCESS_KEY
    - unset AWS_ACCESS_KEY_ID
    - ENVPAY_GLO=`aws secretsmanager get-secret-value --version-stage AWSCURRENT --secret-id NON-PROD/$ENV/$PROJECT/ENVPAY_GLO --output text --query SecretString ` || ENVPAY_GLO=`aws secretsmanager get-secret-value --version-stage AWSCURRENT --secret-id NON-PROD/DEV/ENVPAY_GLO --output text --query SecretString `
    - ENVPAY_GLO_MERCHANT_ID=`echo $ENVPAY_GLO | jq '.merchant_id' -r`
    - ENVPAY_GLO_SECRET=`echo $ENVPAY_GLO | jq '.secret' -r`
    - ENVPAY_GLO_ACCOUNT=`echo $ENVPAY_GLO | jq '.account' -r`
    - oc delete secret envpay-glo || true
    - oc create secret generic envpay-glo --from-literal=merchant_id=${ENVPAY_GLO_MERCHANT_ID} --from-literal=secret=${ENVPAY_GLO_SECRET} --from-literal=account=${ENVPAY_GLO_ACCOUNT}

    - ENVPAY_CMI=`aws secretsmanager get-secret-value --version-stage AWSCURRENT --secret-id NON-PROD/$ENV/$PROJECT/ENVPAY_CMI --output text --query SecretString ` || ENVPAY_CMI=`aws secretsmanager get-secret-value --version-stage AWSCURRENT --secret-id NON-PROD/DEV/ENVPAY_CMI --output text --query SecretString `
    - ENVPAY_CMI_MERCHANT_ID=`echo $ENVPAY_CMI | jq '.merchant_id' -r`
    - ENVPAY_CMI_STOREKEY=`echo $ENVPAY_CMI | jq '.storekey' -r`
    - oc delete secret envpay-cmi || true
    - oc create secret generic envpay-cmi --from-literal=merchant_id=${ENVPAY_CMI_MERCHANT_ID} --from-literal=storekey=${ENVPAY_CMI_STOREKEY}

    - ENVPAY_PAYGATE=`aws secretsmanager get-secret-value --version-stage AWSCURRENT --secret-id NON-PROD/$ENV/$PROJECT/ENVPAY_PAYGATE --output text --query SecretString ` || ENVPAY_PAYGATE=`aws secretsmanager get-secret-value --version-stage AWSCURRENT --secret-id NON-PROD/DEV/ENVPAY_PAYGATE --output text --query SecretString `
    - ENVPAY_PAYGATE_KEY=`echo $ENVPAY_PAYGATE | jq '.key' -r`
    - ENVPAY_PAYGATE_ID=`echo $ENVPAY_PAYGATE | jq '.id' -r`
    - ENVPAY_PAYGATE_EMAIL=`echo $ENVPAY_PAYGATE | jq '.email' -r`
    - oc delete secret envpay-paygate || true
    - oc create secret generic envpay-paygate --from-literal=key=${ENVPAY_PAYGATE_KEY} --from-literal=id=${ENVPAY_PAYGATE_ID} --from-literal=email=${ENVPAY_PAYGATE_EMAIL}

    - ENVPAY_TINGG=`aws secretsmanager get-secret-value --version-stage AWSCURRENT --secret-id NON-PROD/$ENV/$PROJECT/ENVPAY_TINGG --output text --query SecretString ` || ENVPAY_TINGG=`aws secretsmanager get-secret-value --version-stage AWSCURRENT --secret-id NON-PROD/DEV/ENVPAY_TINGG --output text --query SecretString `
    - ENVPAY_TINGG_ACCOUNT=`echo $ENVPAY_TINGG | jq '.account' -r`
    - ENVPAY_TINGG_SERVICE_CODE=`echo $ENVPAY_TINGG | jq '.service_code' -r`
    - ENVPAY_TINGG_IVKEY=`echo $ENVPAY_TINGG | jq '.ivkey' -r`
    - ENVPAY_TINGG_SECRET_KEY=`echo $ENVPAY_TINGG | jq '.secret_key' -r`
    - ENVPAY_TINGG_ACCESS_KEY=`echo $ENVPAY_TINGG | jq '.access_key' -r`
    - oc delete secret envpay-tingg || true
    - oc create secret generic envpay-tingg --from-literal=account=${ENVPAY_TINGG_ACCOUNT} --from-literal=service_code=${ENVPAY_TINGG_SERVICE_CODE} --from-literal=ivkey=${ENVPAY_TINGG_IVKEY} --from-literal=secret_key=${ENVPAY_TINGG_SECRET_KEY} --from-literal=access_key=${ENVPAY_TINGG_ACCESS_KEY}

    - ENVPAY_FAW=`aws secretsmanager get-secret-value --version-stage AWSCURRENT --secret-id NON-PROD/$ENV/$PROJECT/ENVPAY_FAW --output text --query SecretString ` || ENVPAY_FAW=`aws secretsmanager get-secret-value --version-stage AWSCURRENT --secret-id NON-PROD/DEV/ENVPAY_FAW --output text --query SecretString `
    - ENVPAY_FAW_MERCHANT_ID=`echo $ENVPAY_FAW | jq '.merchant_id' -r`
    - ENVPAY_FAW_SECRET_KEY=`echo $ENVPAY_FAW | jq '.secret_key' -r`
    - oc delete secret envpay-faw || true
    - oc create secret generic envpay-faw --from-literal=merchant_id=${ENVPAY_FAW_MERCHANT_ID} --from-literal=secret_key=${ENVPAY_FAW_SECRET_KEY}

    - ENVPAY_PAYPAL=`aws secretsmanager get-secret-value --version-stage AWSCURRENT --secret-id NON-PROD/$ENV/$PROJECT/ENVPAY_PAYPAL --output text --query SecretString ` || ENVPAY_PAYPAL=`aws secretsmanager get-secret-value --version-stage AWSCURRENT --secret-id NON-PROD/DEV/ENVPAY_PAYPAL --output text --query SecretString `
    - ENVPAY_PAYPAL_ACCOUNT=`echo $ENVPAY_PAYPAL | jq '.account' -r`
    - oc delete secret envpay-paypal || true
    - oc create secret generic envpay-paypal --from-literal=account=${ENVPAY_PAYPAL_ACCOUNT}

    - ENVPAY_PAYU=`aws secretsmanager get-secret-value --version-stage AWSCURRENT --secret-id NON-PROD/$ENV/$PROJECT/ENVPAY_PAYU --output text --query SecretString ` || ENVPAY_PAYU=`aws secretsmanager get-secret-value --version-stage AWSCURRENT --secret-id NON-PROD/DEV/ENVPAY_PAYU --output text --query SecretString `
    - ENVPAY_PAYU_NGALL2BE_APP_ID=`echo $ENVPAY_PAYU | jq '.ngall2be_app_id' -r`
    - ENVPAY_PAYU_NGALL2BE_PRIVATE_KEY=`echo $ENVPAY_PAYU | jq '.ngall2be_private_key' -r`
    - ENVPAY_PAYU_KEALL2BE_APP_ID=`echo $ENVPAY_PAYU | jq '.keall2be_app_id' -r`
    - ENVPAY_PAYU_KEALL2BE_PRIVATE_KEY=`echo $ENVPAY_PAYU | jq '.keall2be_private_key' -r`
    - oc delete secret envpay-payu || true
    - oc create secret generic envpay-payu --from-literal=ngall2be_app_id=${ENVPAY_PAYU_NGALL2BE_APP_ID} --from-literal=ngall2be_private_key=${ENVPAY_PAYU_NGALL2BE_PRIVATE_KEY} --from-literal=keall2be_app_id=${ENVPAY_PAYU_KEALL2BE_APP_ID} --from-literal=keall2be_private_key=${ENVPAY_PAYU_KEALL2BE_PRIVATE_KEY}

    - ENVPAY_BANK=`aws secretsmanager get-secret-value --version-stage AWSCURRENT --secret-id NON-PROD/$ENV/$PROJECT/ENVPAY_BANK --output text --query SecretString ` || ENVPAY_BANK=`aws secretsmanager get-secret-value --version-stage AWSCURRENT --secret-id NON-PROD/DEV/ENVPAY_BANK --output text --query SecretString `
    - ENVPAY_BANK_PASSWORD=`echo $ENVPAY_BANK | jq '.password' -r`
    - oc delete secret envpay-bank || true
    - oc create secret generic envpay-bank --from-literal=password=${ENVPAY_BANK_PASSWORD}

    - ENVPAY_KBANK=`aws secretsmanager get-secret-value --version-stage AWSCURRENT --secret-id NON-PROD/$ENV/$PROJECT/ENVPAY_KBANK --output text --query SecretString ` || ENVPAY_KBANK=`aws secretsmanager get-secret-value --version-stage AWSCURRENT --secret-id NON-PROD/DEV/ENVPAY_KBANK --output text --query SecretString `
    - ENVPAY_KBANK_API_KEY=`echo $ENVPAY_KBANK | jq '.api_key' -r`
    - ENVPAY_KBANK_SECRET=`echo $ENVPAY_KBANK | jq '.secret' -r`
    - ENVPAY_KBANK_MID=`echo $ENVPAY_KBANK | jq '.mid' -r`
    - oc delete secret envpay-kbank || true
    - oc create secret generic envpay-kbank --from-literal=api_key=${ENVPAY_KBANK_API_KEY} --from-literal=secret=${ENVPAY_KBANK_SECRET} --from-literal=mid=${ENVPAY_KBANK_MID}

    - ENVPAY_PAYFORT=`aws secretsmanager get-secret-value --version-stage AWSCURRENT --secret-id NON-PROD/$ENV/$PROJECT/ENVPAY_PAYFORT --output text --query SecretString ` || ENVPAY_PAYFORT=`aws secretsmanager get-secret-value --version-stage AWSCURRENT --secret-id NON-PROD/DEV/ENVPAY_PAYFORT --output text --query SecretString `
    - ENVPAY_PAYFORT_MERCHANT_ID=`echo $ENVPAY_PAYFORT | jq '.merchant_id' -r`
    - ENVPAY_PAYFORT_ACCESS_CODE=`echo $ENVPAY_PAYFORT | jq '.access_code' -r`
    - ENVPAY_PAYFORT_REQUEST_PHRASE=`echo $ENVPAY_PAYFORT | jq '.request_phrase' -r`
    - ENVPAY_PAYFORT_RESPONSE_PHRASE=`echo $ENVPAY_PAYFORT | jq '.response_phrase' -r`
    - oc delete secret envpay-payfort || true
    - oc create secret generic envpay-payfort --from-literal=merchant_id=${ENVPAY_PAYFORT_MERCHANT_ID} --from-literal=access_code=${ENVPAY_PAYFORT_ACCESS_CODE} --from-literal=request_phrase=${ENVPAY_PAYFORT_REQUEST_PHRASE} --from-literal=response_phrase=${ENVPAY_PAYFORT_RESPONSE_PHRASE}
